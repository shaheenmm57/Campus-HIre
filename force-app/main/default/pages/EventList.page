<apex:page showHeader="false" sidebar="false" standardStylesheets="false" applyHtmlTag="true" controller="EventList">
<head>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,800;1,100;1,200;1,300;1,400;1,500;1,800&display=swap" rel="stylesheet"/>
<style>
              :root{
          --blue-color: #150958;
          --text-color: black;
          --background-color: white;
          --red-color: #EF233C;
          }
          *{
          margin: 0;
          padding: 0;
          font-family: 'Poppins', sans-serif;
        }
        .main{
          height: 100vh;
          width: 100%;  
        }
            .header {
            height: 10vh;
            width: 100%;
            background: var(--blue-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            }
            .novigo-icon{
          height: 8vh;
          margin-left: 8px;
        }
        .title {
            /* margin-top: 4vh; */
            margin-right:4vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: sticky;
            top: 0;
            /* background-color: white; */
            z-index: 1;
        }
        .title-text {
            font-size: 2vw;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            padding:10px;
            color: var(--background-color);
        }

        button{
            width: 10vw;
            margin-left: 50vh;
            margin-top: 5vh;
            background-color: #150958; 
            color: white; 
            border-radius: 5px; 
            border: 2px solid #150958; 
            cursor: pointer;
            transition: ease-in-out 0.2s;
        }
        button:hover{
          background-color: var(--red-color);
        }
                    table {
                    border-collapse: collapse;
                    width: 50%;
                    margin-left: 50vh;
                    margin-top: 25vh;
                    font-size: 0.9em;
                    font-family: sans-serif;
                    box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
                }
                th, td {
                    border: 1px solid #ddd;
                    padding: 8px;
                    text-align: left;
                }
                th {
                    background-color: #f2f2f2;
                }
                
                .eventText:hover{
                    color: var(--red-color);
                }

</style>
<script>

    window.onload = showTable('yes',2);


    
            function showTable(eventId,check) {
            // Call an action in the controller to fetch associated contacts and re-render the table
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.EventList.showResults}',
                eventId,
                check,
                function(result, event) {
                    if (event.status) {
                        // Handle the result and re-render the table
                        var tableHtml = '';
                        tableHtml += '<table>';
                        if (check == 1){
                            console.log(result.studentInfoList);
                            tableHtml += '<tr><th>Student Name</th><th>Marks Scored</th><th>Cleared</th></tr>';
                            for (var i = 0; i < result.studentInfoList.length; i++) {
                                tableHtml += '<tr>';
                                tableHtml += '<td>' + result.studentInfoList[i].studentName + '</td>';
                                tableHtml += '<td>' + result.studentInfoList[i].marksScored + '</td>';
                                tableHtml += '<td>' + result.studentInfoList[i].clearedCutoff + '</td>';
                                tableHtml += '</tr>';
                            }
                            tableHtml += '</table>';
                            tableHtml += '<button type = "button" onclick = "showTable(\'yes\',2)"> Go back </button>'
                        }
                        else{
                            tableHtml += '<tr><th> Event Name</th><th> Event Date</th></tr>'
                            for (var i = 0; i < result.Event_List.length; i++){
                            
                                var timestamp = result.Event_List[i].event_date__c;

                                // Convert the timestamp to a Date object
                                var date = new Date(timestamp);

                                // Define an array of suffixes for the day (e.g., 'st', 'nd', 'rd', 'th')
                                var daySuffixes = ['st', 'nd', 'rd', 'th'];

                                // Get the day of the month
                                var day = date.getDate();

                                // Determine the day suffix based on the day
                                var daySuffix = daySuffixes[(day >= 11 && day <= 13) ? 3 : (day % 10) - 1];

                                // Define an array of month names
                                var monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

                                // Get the month name
                                var monthName = monthNames[date.getMonth()];

                                // Get the year
                                var year = date.getFullYear();

                                // Create the formatted date string
                                var formattedDate = day + daySuffix + ' ' + monthName + ' ' + year;

                                tableHtml += '<tr>';
                                tableHtml += '<td> <a class = "eventText" href="javascript:void(0);" onclick="showTable(\'' + result.Event_List[i].Id + '\',1)">' + result.Event_List[i].Name + '</a></td>';   
                                tableHtml += '<td>'+ formattedDate +'</td>';
                                tableHtml += '</tr>';
                                }
                                tableHtml += '</table>';

                        }
                        // Replace the existing table with the updated table
                        document.getElementById('displayTable').innerHTML = tableHtml;
                    } 
                    
                    else {
                        alert('Error fetching contacts: ' + event.message);
                    }
                },
                { escape: false }
            );
        }
</script>
</head>
<body>
    <div class = "main">
    <div class="header">
        <div>
            <img class="novigo-icon" src="{!URLFOR($Resource.novigo_logo)}" alt="Novigo Icon"/>
        </div>
        <div class="title">
            <img class="create-event-icon" src="{!URLFOR($Resource.RegisterCollegeIcon)}" alt="Create Event Icon" width="50px" height="50px"/>
                &nbsp;
            <span class="title-text">Events</span>
        </div>
      </div>
    <div id = "displayTable">
    </div>
</div>
</body>

</apex:page>